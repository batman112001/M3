<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Upload</title>
<style>
  body { font-family: Arial; padding: 2rem; }
  input, button { padding: 0.5rem; margin: 0.5rem 0; width: 100%; }
</style>
</head>
<body>
<h2>Admin Upload Page</h2>

<input type="text" id="fileId" placeholder="File key (e.g., M5a)">
<input type="text" id="fileUrl" placeholder="Direct download URL">
<button id="uploadBtn">Upload</button>

<script>
const REPO_OWNER = "batman112001"; // your GitHub username
const REPO_NAME = "M3";            // repo name
const FILE_PATH = "files.json";    // JSON file path

document.getElementById("uploadBtn").addEventListener("click", async () => {
  const key = document.getElementById("fileId").value.trim();
  const url = document.getElementById("fileUrl").value.trim();
  if(!key || !url) { alert("Enter both key and URL!"); return; }

  const TOKEN = prompt("Enter your GitHub Personal Access Token (kept private in browser)");

  // 1️⃣ Fetch existing files.json
  const res = await fetch(`https://api.github.com/repos/${REPO_OWNER}/${REPO_NAME}/contents/${FILE_PATH}`, {
    headers: { Authorization: `token ${TOKEN}` }
  });
  if(!res.ok) { alert("Error fetching files.json"); return; }
  const data = await res.json();
  
  // 2️⃣ Decode content
  const content = JSON.parse(atob(data.content));
  content[key] = url;

  // 3️⃣ Update via PUT
  const putRes = await fetch(`https://api.github.com/repos/${REPO_OWNER}/${REPO_NAME}/contents/${FILE_PATH}`, {
    method: "PUT",
    headers: { 
      Authorization: `token ${TOKEN}`,
      "Content-Type": "application/json"
    },
    body: JSON.stringify({
      message: `Add/update ${key}`,
      content: btoa(JSON.stringify(content, null, 2)),
      sha: data.sha
    })
  });

  if(putRes.ok) alert("Upload successful!");
  else alert("Upload failed. Check token and repo permissions.");
});
</script>
</body>
</html>
